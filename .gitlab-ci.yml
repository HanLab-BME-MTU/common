# Gitlab CI Script for danuser/common
# Andrew R. Jamieson - 2016



# first test job, current matlab version
stages:
  - test

before_script:
  - date
  - w 
  - uname -a
  - module list
  - module unload matlab
  - module load matlab/2016a
  - module list
  - pwd
  
R2016a_cached_:
  stage: test
  script: 
    - matlab -nodisplay -nodesktop -nosplash -r "runCITests('cached', '-verbose');"
  only:
    - CI_test

R2016a_mathfun:
  stage: test
  script: 
    - matlab -nodisplay -nodesktop -nosplash -r "runCITests('~/matlab/common/mathfun/test', '-verbose');"
  only:
    - CI_test
    # - testing

R2016a_toolfun:
  stage: test
  script: 
    - matlab -nodisplay -nodesktop -nosplash -r "runCITests('~/matlab/common/toolfun/test', '-verbose');"
  only:
    - CI_test
    # - testing

R2016a_movieManagement_unit:
  stage: test
  script: 
    - matlab -nodisplay -nodesktop -nosplash -r "runCITests('~/matlab/common/toolfun/movieManagement/test/unit', '-verbose')" 
  only:
    - CI_test
    # - testing

R2016a_movieManagement_integration:
  stage: test
  script: 
    - matlab -nodisplay -nodesktop -nosplash -r "runCITests('~/matlab/common/toolfun/movieManagement/test/integration', '-verbose');" 
  only:
    - CI_test
    # - testing

# matlab -nodisplay -nodesktop -nosplash -r "runxunit -xmlfile ${TARGET_FOLDER}/mathfun-report.xml ~/matlab/common/mathfun/test; exit" &
# matlab -nodisplay -nodesktop -nosplash -r "runxunit -xmlfile ${TARGET_FOLDER}/toolfun-report.xml ~/matlab/common/toolfun/test; exit" &
# matlab -nodisplay -nodesktop -nosplash -r "runxunit -xmlfile ${TARGET_FOLDER}/api-unit-report.xml ~/matlab/common/toolfun/movieManagement/test/unit; exit" &
# matlab -nodisplay -nodesktop -nosplash -r "runxunit -xmlfile ${TARGET_FOLDER}/api-integration-report.xml ~/matlab/common/toolfun/movieManagement/test/integration; exit" &
